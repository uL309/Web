<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CiberTech - Checkout</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <!-- ... (cabe√ßalho id√™ntico) ... -->
    <div class="container topbar">
      <div class="brand">
        <div class="logo">CT</div>
        <div>
          <a href="index.html"><button class="icon-btn" style="font-weight:800;">CiberTech</button></a>
          <div style="font-size:12px;color:var(--muted)">Hardware ‚Ä¢ Perif√©ricos ‚Ä¢ Promo√ß√µes</div>
        </div>
      </div>
      <div class="search" role="search">
        <input type="search" id="main-search" placeholder="Procure por produtos..." aria-label="buscar produto" />
        <button id="search-btn" aria-label="Pesquisar">Buscar</button>
      </div>
      <div class="actions">
        <!-- Populado por js/header.js -->
      </div>
    </div>
</header>

<main class="container">
  <h1 style="margin-bottom:20px;">Checkout</h1>
  <div class="main">
    <div class="sidebar">
      <div class="filter">
        <h2 style="margin-top:0;">Resumo do Pedido</h2>
        <ul style="list-style:none; padding:0; margin:0;" id="summary-list">
          <li style="text-align: center; color: var(--muted); padding: 20px 0;">Carregando resumo...</li>
        </ul>
      </div>
    </div>

    <div class="hero-card">
      
      <!-- ** AVISO DE SIMULA√á√ÉO ** -->
      <div style="padding: 16px; background: #064e3b; color: #10b981; border-radius: 8px; margin-bottom: 24px; text-align: center; font-weight: 600;">
        Esta √© uma simula√ß√£o. Nenhum dado de pagamento real √© coletado ou processado.
      </div>
      
      <h2>Informa√ß√µes de Pagamento</h2>
      <form id="checkout-form">
        
        <!-- Sele√ß√£o de M√©todo de Pagamento -->
        <div style="margin-bottom:20px;">
          <label style="display:block;margin-bottom:8px;font-weight:600">M√©todo de Pagamento</label>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <label style="display:flex;align-items:center;padding:12px;border:2px solid rgba(255,255,255,0.1);border-radius:8px;cursor:pointer;transition:all 0.3s" class="payment-option">
              <input type="radio" name="payment_method" value="credit_card" checked style="margin-right:8px">
              <span>üí≥ Cart√£o de Cr√©dito (Sim)</span>
            </label>
            <label style="display:flex;align-items:center;padding:12px;border:2px solid rgba(255,255,255,0.1);border-radius:8px;cursor:pointer;transition:all 0.3s" class="payment-option">
              <input type="radio" name="payment_method" value="pix" style="margin-right:8px">
              <span>üì± PIX (Sim)</span>
            </label>
            <label style="display:flex;align-items:center;padding:12px;border:2px solid rgba(255,255,255,0.1);border-radius:8px;cursor:pointer;transition:all 0.3s" class="payment-option">
              <input type="radio" name="payment_method" value="boleto" style="margin-right:8px">
              <span>üßæ Boleto (Sim)</span>
            </label>
          </div>
        </div>

        <!-- Campos de Cart√£o Removidos -->
        <!-- O formul√°rio coletava dados sens√≠veis sem process√°-los. -->
        <!-- Isso foi removido por seguran√ßa. -->

        <!-- Parcelas (apenas para cart√£o de cr√©dito) -->
        <div style="margin-bottom:12px;" id="installments-field">
          <label for="installments">N√∫mero de parcelas</label><br>
          <select id="installments" name="installments" style="width:100%; padding:10px; border-radius:8px; border:0;background:#0b1020;color:#e6eef8">
            <option value="1">1x √† vista (simulado)</option>
            <option value="2">2x (simulado)</option>
            <option value="3">3x (simulado)</option>
            <!-- ... -->
            <option value="12">12x (simulado)</option>
          </select>
        </div>

        <!-- Informa√ß√µes PIX (oculto por padr√£o) -->
        <div id="pix-info" style="display:none;margin-bottom:20px;padding:20px;background:rgba(255,255,255,0.05);border-radius:8px">
          <p style="margin:0 0 12px;color:var(--muted)">Um c√≥digo PIX seria gerado ap√≥s a confirma√ß√£o.</p>
        </div>

        <!-- Informa√ß√µes Boleto (oculto por padr√£o) -->
        <div id="boleto-info" style="display:none;margin-bottom:20px;padding:20px;background:rgba(255,255,255,0.05);border-radius:8px">
           <p style="margin:0 0 12px;color:var(--muted)">Um boleto seria gerado ap√≥s a confirma√ß√£o.</p>
        </div>

        <!-- Endere√ßo de Entrega (Simplificado) -->
        <div style="margin-bottom:20px;border-top:1px solid rgba(255,255,255,0.1);padding-top:20px">
          <h3 style="margin:0 0 12px">Endere√ßo de Entrega</h3>
          <div style="margin-bottom:12px;">
            <label for="cep">CEP (Simulado)</label><br>
            <input type="text" id="cep" name="cep" placeholder="00000-000" maxlength="9" style="width:100%; padding:10px; border-radius:8px; border:0;background:#0b1020;color:#e6eef8">
          </div>
          <div style="margin-bottom:12px;">
            <label for="address">Endere√ßo completo (Simulado)</label><br>
            <textarea id="address" name="address" placeholder="Rua, N√∫mero, Bairro..." rows="3" style="width:100%; padding:10px; border-radius:8px; border:0;background:#0b1020;color:#e6eef8;resize:vertical"></textarea>
          </div>
        </div>

        <button type="submit" class="cta" style="width:100%;">Finalizar Compra (Simula√ß√£o)</button>
      </form>
    </div>
  </div>
</main>

<footer style="margin-top:18px">
    <!-- ... (rodap√© id√™ntico) ... -->
    <div class="container">
      <div class="footer-content">
        <div class="footer-left">
          <div style="font-weight:800">CiberTech</div>
          <div style="color:var(--muted)">¬© 2025 ‚Ä¢ Todos os direitos reservados</div>
        </div>
        <div class="footer-right" style="color:var(--muted)">
          Pagamento seguro ‚Ä¢ Parcelamos em at√© 12x
          <a href="admin-produtos.html" style="margin-left:12px; color:var(--primary); text-decoration:none; font-weight:600;">
            Admin
          </a>
        </div>
      </div>
    </div>
</footer>

<script src="js/header.js"></script>
<script>
  // Controla exibi√ß√£o dos campos conforme m√©todo de pagamento
  function setupPaymentMethodToggle() {
    const radioButtons = document.querySelectorAll('input[name="payment_method"]');
    const pixInfo = document.getElementById('pix-info');
    const boletoInfo = document.getElementById('boleto-info');
    const installmentsDiv = document.getElementById('installments-field');

    radioButtons.forEach(radio => {
      radio.addEventListener('change', (e) => {
        const method = e.target.value;
        
        if (pixInfo) pixInfo.style.display = 'none';
        if (boletoInfo) boletoInfo.style.display = 'none';
        if (installmentsDiv) installmentsDiv.style.display = 'none';

        if (method === 'credit_card') {
          if (installmentsDiv) installmentsDiv.style.display = 'block';
        } else if (method === 'pix') {
          if (pixInfo) pixInfo.style.display = 'block';
        } else if (method === 'boleto') {
          if (boletoInfo) boletoInfo.style.display = 'block';
        }
      });
    });

    // Define estado inicial
    const creditCardRadio = document.querySelector('input[value="credit_card"]');
    if (creditCardRadio && creditCardRadio.checked) {
      if (installmentsDiv) installmentsDiv.style.display = 'block';
    }
  }

  // Carrega resumo do carrinho
  async function loadCartSummary() {
    try {
      const res = await fetch('php/cart.php');
      const data = await res.json();
      const summaryList = document.getElementById('summary-list');
      if (!summaryList) return;

      if (!data.success || !data.items || data.items.length === 0) {
        alert('Seu carrinho est√° vazio!');
        window.location.href = 'index.html';
        return;
      }

      const FRETE = 49.90; // Simula√ß√£o de frete
      const total = data.total + FRETE;
      
      const formatPrice = (val) => parseFloat(val).toFixed(2).replace('.', ',');

      summaryList.innerHTML = data.items.map(item => `
        <li style="display:flex; justify-content:space-between; margin-bottom:8px; font-size: 14px;">
          <span style="max-width: 70%;">${item.nome} (x${item.quantidade})</span> 
          <span>R$ ${formatPrice(item.preco * item.quantidade)}</span>
        </li>
      `).join('') + `
        <li style="display:flex; justify-content:space-between; margin-bottom:8px; color:var(--muted); border-top: 1px solid var(--border-color); padding-top: 8px; margin-top: 8px;">
          <span>Subtotal</span> <span>R$ ${formatPrice(data.total)}</span>
        </li>
        <li style="display:flex; justify-content:space-between; margin-bottom:8px; color:var(--muted)">
          <span>Frete (Fixo)</span> <span>R$ ${formatPrice(FRETE)}</span>
        </li>
        <li style="display:flex; justify-content:space-between; font-weight:800; margin-top:12px; font-size: 18px;">
          <span>Total</span> <span>R$ ${formatPrice(total)}</span>
        </li>
      `;

    } catch (err) {
      console.error('Erro ao carregar carrinho:', err);
       document.getElementById('summary-list').innerHTML = '<li>Erro ao carregar resumo.</li>';
    }
  }

  // Processa o checkout
  async function processCheckout(e) {
    e.preventDefault();
    
    const form = e.target;
    const submitBtn = form.querySelector('button[type="submit"]');
    if (!submitBtn) return;
    
    submitBtn.disabled = true;
    submitBtn.textContent = 'Processando Simula√ß√£o...';

    try {
      const paymentMethod = form.payment_method?.value || 'credit_card';
      
      const paymentMethodMap = {
        'credit_card': 'credito',
        'debit_card': 'debito',
        'pix': 'pix',
        'boleto': 'boleto'
      };
      
      const formData = {
        endereco_entrega: form.address?.value || 'Endere√ßo Simulado',
        cep: form.cep?.value || '00000-000',
        forma_pagamento: paymentMethodMap[paymentMethod] || 'credito',
        parcelas: paymentMethod === 'credit_card' ? (form.installments?.value || '1') : '1',
        frete: 49.90 // Frete fixo simulado
      };

      const res = await fetch('php/checkout.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      });

      const data = await res.json();

      if (!data.success) {
        alert(data.error || 'Erro ao processar pedido');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Finalizar Compra (Simula√ß√£o)';
        return;
      }

      alert('Pedido (simulado) realizado com sucesso! N√∫mero do pedido: ' + data.pedido_id);
      window.location.href = `pedido-detalhe.html?id=${data.pedido_id}`;

    } catch (err) {
      console.error('Erro no checkout:', err);
      alert('Erro ao processar pedido. Tente novamente.');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Finalizar Compra (Simula√ß√£o)';
    }
  }

  // Adiciona handler ao formul√°rio
  const checkoutForm = document.getElementById('checkout-form');
  if (checkoutForm) {
    checkoutForm.addEventListener('submit', processCheckout);
  }

  // Inicializa ao carregar
  document.addEventListener('DOMContentLoaded', () => {
    setupPaymentMethodToggle();
    loadCartSummary();
  });
</script>

</body>
</html>